<%
var template = JST["backbone/templates/email_folders/tree_nodes"];

var renderChildren, emailFolder, haveChildren, badgeString, style;

renderChildren = function() {
  var childName;

  for (childName in node.children) {
    child = node.children[childName] %>
    <%= template({nodeName: childName, node: child}) %><%
  }
}

emailFolder = node.emailFolder;

if (emailFolder) {
  haveChildren = _.keys(node.children).length > 0;

  if (emailFolder.num_unread_threads === 0) {
    badgeString = "";
  } else {
    badgeString = emailFolder.num_unread_threads;
  }

  if (emailFolder.label_type !== "system") {
    style = "";
  
    if (!haveChildren) {
      style += "label_without_children";
    }
  
    if (emailFolder.num_unread_threads > 0) {
      style += " contains_unread_emails";
    } else {
      style += " contains_no_unread_emails";
    }
  
    style = style.trim();%>

    <ul>
      <li class="<%= style %>">
        <% if (haveChildren) { %>
          <span class="bullet_span">â€£ </span>
        <% } %>
        <a id="<%= emailFolder.label_id %>" class="label_link" href="#email_folder/<%= emailFolder.label_id %>">
          <%= nodeName %> <span class="badge"><%= badgeString %></span>
        </a><%
  }
    
  renderChildren();%>
      </li>
    </ul><%
} else {
  renderChildren();
}
%>
